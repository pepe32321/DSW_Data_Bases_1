-- Bazy danych Lista 2

--Zad1

SELECT ZESPOLY.NAZWA, PRACOWNICY.ETAT, MIN(PRACOWNICY.PLACA_POD), AVG(PRACOWNICY.PLACA_POD) ,COUNT(*)
FROM PRACOWNICY
RIGHT JOIN ZESPOLY ON
PRACOWNICY.ID_ZESP = ZESPOLY.ID_ZESP
RIGHT JOIN ETATY ON
PRACOWNICY.ETAT = ETATY.NAZWA
GROUP BY ZESPOLY.NAZWA, PRACOWNICY.ETAT
HAVING COUNT(*)>1 AND COUNT(PLACA_DOD)<=1 AND AVG(PRACOWNICY.PLACA_DOD)>= 0.25*MIN(PRACOWNICY.PLACA_POD) AND AVG(PRACOWNICY.PLACA_DOD)<= 0.75*MAX(PRACOWNICY.PLACA_POD)
ORDER BY PRACOWNICY.ETAT;

SELECT ZESPOLY.NAZWA, PRACOWNICY.ETAT, MIN(PRACOWNICY.PLACA_POD), AVG(PRACOWNICY.PLACA_POD) ,COUNT(*)
FROM PRACOWNICY
RIGHT JOIN ZESPOLY ON
PRACOWNICY.ID_ZESP = ZESPOLY.ID_ZESP
RIGHT JOIN ETATY ON
PRACOWNICY.ETAT = ETATY.NAZWA
GROUP BY ZESPOLY.NAZWA, PRACOWNICY.ETAT
HAVING COUNT(*)>1 AND COUNT(PLACA_DOD)<=1 AND AVG(PRACOWNICY.PLACA_DOD)>= 0.25*MIN(PRACOWNICY.PLACA_POD) AND AVG(PRACOWNICY.PLACA_DOD)<= 0.60*MAX(PRACOWNICY.PLACA_POD)
ORDER BY PRACOWNICY.ETAT;

--Tak, nie wyświetli się wynik z zespołem SYSTEMY EKSPERCKIE


--Zad2

SELECT p.NAZWISKO, p.PLACA_POD
FROM PRACOWNICY p
JOIN PRACOWNICY d ON d.ETAT = 'DYREKTOR'
WHERE p.ETAT != 'DYREKTOR' AND p.PLACA_POD + p.PLACA_DOD >= d.PLACA_POD/2
ORDER BY p.PLACA_POD DESC;


--Zad3

SELECT p.NAZWISKO, p.PLACA_POD 
FROM PRACOWNICY p
LEFT JOIN ZESPOLY z ON
p.ID_ZESP = z.ID_ZESP
LEFT JOIN ETATY es ON
es.NAZWA = 'SEKRETARKA'
LEFT JOIN ETATY ep ON
ep.NAZWA = 'PROFESOR'
WHERE z.ADRES LIKE 'WIENIAWSKIEGO 16'
AND p.PLACA_POD + p.PLACA_DOD >= 2 * es.PLACA_DO 
AND p.PLACA_POD + p.PLACA_DOD <= ep.PLACA_OD;


--Zad4

SELECT p.NAZWISKO, d.NAZWISKO
FROM PRACOWNICY p
INNER JOIN PRACOWNICY d ON
p.NAZWISKO < d.NAZWISKO
WHERE p.NAZWISKO != d.NAZWISKO
AND ABS(12 * (p.PLACA_POD + p.PLACA_DOD) - 12 * (d.PLACA_POD + d.PLACA_DOD))/LEAST(12 * (p.PLACA_POD + p.PLACA_DOD), 12 * (d.PLACA_POD + d.PLACA_DOD)) <= 0.05;


--Zad5

SELECT p.NAZWISKO, zp.ADRES, d.NAZWISKO, zd.ADRES
FROM PRACOWNICY p
JOIN ZESPOLY zp ON
p.ID_ZESP = zp.ID_ZESP
INNER JOIN PRACOWNICY d ON
p.NAZWISKO < d.NAZWISKO
JOIN ZESPOLY zd ON
d.ID_ZESP = zd.ID_ZESP 
WHERE p.NAZWISKO != d.NAZWISKO
AND ABS(12 * (p.PLACA_POD + p.PLACA_DOD) - 12 * (d.PLACA_POD + d.PLACA_DOD))/LEAST(12 * (p.PLACA_POD + p.PLACA_DOD), 12 * (d.PLACA_POD + d.PLACA_DOD)) <= 0.05
AND zp.ADRES = zd.ADRES;


--Zad6

SELECT * FROM PRACOWNICY p
LEFT JOIN PRACOWNICY s ON
p.ID_SZEFA = s.ID_PRAC
WHERE p.ID_ZESP != s.ID_ZESP
OR p.ID_SZEFA IS NULL
OR p.ID_ZESP IS NULL
OR s.ID_ZESP IS NULL;

--Zad7

SELECT ADRES, COUNT(*) FROM PRACOWNICY 
NATURAL LEFT JOIN ZESPOLY 
GROUP BY ADRES;